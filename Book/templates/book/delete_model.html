{# expects `book` in context #}

{% if request.user.is_authenticated and (request.user == book.owner or request.user.is_staff) %}
  <!-- Delete trigger -->
  <button type="button"
          class="btn btn-outline-danger"
          data-bs-toggle="modal"
          data-bs-target="#confirmDeleteModal-{{ book.id }}">
    Delete
  </button>

  <!-- Modal -->
  <div class="modal fade" id="confirmDeleteModal-{{ book.id }}" tabindex="-1"
       aria-labelledby="confirmDeleteLabel-{{ book.id }}" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content border-0 shadow">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title" id="confirmDeleteLabel-{{ book.id }}">Delete this book?</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          You’re about to delete <strong>{{ book.title }}</strong> by {{ book.author }}.
          This action cannot be undone.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button"
                  class="btn btn-danger"
                  onclick="__deleteBook('{{ book.id }}', '{% url 'deleteBook' id=book.id %}')">
            Yes, delete
          </button>
        </div>
      </div>
    </div>
  </div>
{% endif %}

<script>
  (function() {
    if (window.__deleteBook) return; // don’t redefine if already loaded

    function getCookie(name) {
      const cookies = document.cookie.split(';');
      for (let c of cookies) {
        c = c.trim();
        if (c.startsWith(name + '=')) {
          return decodeURIComponent(c.substring(name.length + 1));
        }
      }
      return null;
    }

    window.__deleteBook = function(bookId, actionUrl) {
      const csrf = getCookie('csrftoken');
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = actionUrl;
      form.style.display = 'none';

      const token = document.createElement('input');
      token.type = 'hidden';
      token.name = 'csrfmiddlewaretoken';
      token.value = csrf;

      form.appendChild(token);
      document.body.appendChild(form);
      form.submit();
    };
  })();
</script>